# MINIMAL TARGETED FIXES

Based on your actual code, I made ONLY these changes:

## 1. index.html - Added Missing HTML Elements

**Added Music/Radio buttons** (line 157):
```html
<button onclick="Hub.router.go('music')" class="btn btn-secondary text-sm py-2 px-4">ğŸµ Music</button>
<button onclick="Hub.router.go('radio')" class="btn btn-secondary text-sm py-2 px-4">ğŸ“» Radio</button>
```

**Added Now Playing widget** to dashboard (right column, after treats):
```html
<div class="card">
  <h2 class="text-xl font-bold mb-4">ğŸµ Now Playing</h2>
  <div id="nowPlayingWidget"></div>
</div>
```

**Added Now Playing to Standby** (in the grid with calendar/chores/weather):
```html
<div class="card card-glass">
  <h3 class="text-lg font-bold mb-3">ğŸµ Now Playing</h3>
  <div id="standbyNowPlaying"></div>
</div>
```

**Added Music Page** (full SPA page with containers JS expects):
```html
<div id="musicPage" class="page">
  <div class="max-w-4xl mx-auto p-4">
    <button onclick="Hub.router.go('dashboard')" class="btn btn-secondary mb-4">â† Back</button>
    <h1 class="text-3xl font-bold mb-6">ğŸµ Music</h1>
    <div id="musicPlayerContainer"></div>
    <div id="bluetoothHelp" class="mt-6"></div>
  </div>
</div>
```

**Added Radio Page**:
```html
<div id="radioPage" class="page">
  <div class="max-w-4xl mx-auto p-4">
    <button onclick="Hub.router.go('dashboard')" class="btn btn-secondary mb-4">â† Back</button>
    <h1 class="text-3xl font-bold mb-6">ğŸ“» Radio</h1>
    <div id="radioStationList"></div>
  </div>
</div>
```

**Fixed Background CSS** (line 48):
- Changed `var(--bg)` to `var(--bg-base)`

## 2. app.js - Actually Call Chore Reset

**Added call in _onLogin()** (after checkAccess, before _showApp):
```javascript
// Call chore reset fallback (non-blocking)
this._callChoreResetEndpoint().catch(e => 
  console.warn('[App] Chore reset fallback failed:', e.message)
);
```

**Updated _callChoreResetEndpoint()** to use the safe endpoint:
```javascript
async _callChoreResetEndpoint() {
  if (!Hub.state.household_id) return;
  
  try {
    const { data } = await Hub.sb.auth.getSession();
    const token = data?.session?.access_token;
    if (!token) {
      console.log('[App] No token, skip chore reset');
      return;
    }
    
    const response = await fetch('/api/chores-reset-my-household', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${token}`
      },
      body: JSON.stringify({ tz: 'America/New_York' })
    });
    
    const result = await response.json();
    console.log('[App] Chore reset result:', result);
    
    if (result.resetCount > 0 && Hub.router.current === 'chores') {
      Hub.chores?.load?.();
    }
  } catch (error) {
    console.error('[App] Chore reset error:', error);
  }
}
```

## 3. api/cron-chores-reset.js - Pure Fetch Implementation

**Completely rewrote** to use Supabase REST API (no esm.sh imports):
- Uses SUPABASE_SERVICE_ROLE_KEY
- Computes "today" in America/New_York timezone
- Fetches all households
- Resets chores where needed
- Updates last_chore_reset_date
- Idempotent and safe

## 4. vercel.json - Hourly Cron

**Changed schedule** from daily to hourly:
```json
"schedule": "0 * * * *"
```

The endpoint itself checks if date changed, so hourly is DST-safe.

## 5. treats.js - Today-Only Calories + Recent List

**Added timestamp** to new treats:
```javascript
ts: Date.now()
```

**Fixed renderDashboardWidget()** to:
- Compute todayStart in America/New_York timezone
- Filter items to today only
- Show "Recent Treats" list (last 5)
- Add "View full history â†’" link

---

These are MINIMAL, TARGETED fixes. Nothing else changed.
