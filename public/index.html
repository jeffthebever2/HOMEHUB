<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ  Home Hub</title>
  <link rel="manifest" href="/manifest.webmanifest">
  <meta name="theme-color" content="#1e293b">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="apple-touch-icon" href="/icons/icon-192.png">

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Supabase JS v2 -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <!-- Firebase compat SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.7.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.2/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.2/firebase-auth-compat.js"></script>

  <!-- Firebase Config for Dog Tracker -->
  <script>
    window.HOME_HUB_CONFIG = window.HOME_HUB_CONFIG || {};
    window.HOME_HUB_CONFIG.firebase = {
      apiKey: "AIzaSyBISAQF9xw2ifb9HllNj4LniyMLD6OhclU",
      authDomain: "dog-calorie-counter.firebaseapp.com",
      databaseURL: "https://dog-calorie-counter-default-rtdb.firebaseio.com",
      projectId: "dog-calorie-counter",
      storageBucket: "dog-calorie-counter.firebasestorage.app",
      messagingSenderId: "835874316228",
      appId: "1:835874316228:web:cbebd7e0ad3b071352ce91"
    };
  </script>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

  <!-- App config (must come before app scripts) -->
  <script src="config.js"></script>

  <style>
        :root {
      --bg-base: #0B0F19; --bg-surface-1: #151B2B; --bg-card: #1A2235;
      --accent-primary: #3B82F6; --accent-glow: rgba(59, 130, 246, 0.2);
    }
    @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes shimmer { 0% { background-position: -200% 0; } 100% { background-position: 200% 0; } }
    @keyframes kenBurns { 0% { transform: scale(1); } 50% { transform: scale(1.1) translate(-5%, -5%); } 100% { transform: scale(1); } }
    body { background: var(--bg-base); color: #f9fafb; font-family: 'Inter', system-ui, sans-serif; margin: 0; }
    .card { background: linear-gradient(145deg, var(--bg-surface-1), var(--bg-card)); border-radius: 1rem; padding: 1.5rem; margin-bottom: 1.5rem; box-shadow: 0 4px 6px rgba(0,0,0,.3); }
    .btn { padding: .5rem 1rem; border-radius: .5rem; font-weight: 500; cursor: pointer; transition: all .2s; border: none; display: inline-flex; align-items: center; gap: .4rem; }
    .btn-primary { background: #3b82f6; color: #fff; } .btn-primary:hover { background: #2563eb; }
    .btn-secondary { background: #374151; color: #fff; } .btn-secondary:hover { background: #4b5563; }
    .btn-danger { background: #ef4444; color: #fff; } .btn-danger:hover { background: #dc2626; }
    .btn-success { background: #10b981; color: #fff; } .btn-success:hover { background: #059669; }
    /* â”€â”€ Typography scale â”€â”€ */
    :root {
      --font-display: 2.5rem/1.1 'Inter', system-ui, sans-serif;
      --font-title:   1.5rem/1.2 'Inter', system-ui, sans-serif;
      --font-body:    1rem/1.5   'Inter', system-ui, sans-serif;
      --font-caption: 0.875rem/1.4 'Inter', system-ui, sans-serif;
      --font-micro:   0.75rem/1.3  'Inter', system-ui, sans-serif;
    }

    .input { background: #374151; border: 1px solid #4b5563; border-radius: .5rem; padding: .5rem 1rem; color: #fff; width: 100%; box-sizing: border-box; }
    .input:focus { outline: none; border-color: #3b82f6; }
    .hidden { display: none !important; }
    .page { display: none; } .page.active { display: block; }
    .standby-clock { font-variant-numeric: tabular-nums; letter-spacing: -.05em; }
    .photo-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1rem; }
    .photo-item { aspect-ratio: 16/9; background: #1f2937; border-radius: .5rem; overflow: hidden; }
    .photo-item img { width: 100%; height: 100%; object-fit: cover; transition: opacity 1s; }
    .alert-banner { position: fixed; top: 0; left: 0; right: 0; z-index: 50; padding: .75rem 1rem; text-align: center; font-weight: 700; }
    .alert-banner.warning { background: #ef4444; } .alert-banner.watch { background: #f59e0b; color: #000; } .alert-banner.advisory { background: #eab308; color: #000; }
    .status-dot { display: inline-block; width: .75rem; height: .75rem; border-radius: 50%; }
    .status-dot.green { background: #10b981; } .status-dot.red { background: #ef4444; } .status-dot.yellow { background: #f59e0b; }
    .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,.6); display: flex; align-items: center; justify-content: center; z-index: 60; padding: 1rem; }
    .progress-bar { height: 1rem; background: #374151; border-radius: 9999px; overflow: hidden; }
    .progress-fill { height: 100%; border-radius: 9999px; transition: width .4s; }
    select.input { appearance: auto; }

    /* â”€â”€ Slideshow two-layer crossfade â”€â”€ */
    .slideshow-layer {
      position: absolute; inset: 0;
      width: 100%; height: 100%;
      object-fit: cover;
      will-change: opacity;
      transition: opacity 0.9s ease-in-out;
    }

    /* â”€â”€ Card hover lift (disabled in touchscreen mode) â”€â”€ */
    body:not(.touchscreen-mode) .card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 24px rgba(0,0,0,.4), 0 0 0 1px rgba(255,255,255,.05);
    }
    .card { transition: transform .2s ease, box-shadow .2s ease; }

    /* â”€â”€ Staggered card entrance â”€â”€ */
    @keyframes cardIn { from { opacity:0; transform:translateY(20px); } to { opacity:1; transform:translateY(0); } }
    .card-enter { animation: cardIn .4s ease both; }
    .card-enter:nth-child(1) { animation-delay: 0ms; }
    .card-enter:nth-child(2) { animation-delay: 50ms; }
    .card-enter:nth-child(3) { animation-delay: 100ms; }
    .card-enter:nth-child(4) { animation-delay: 150ms; }
    .card-enter:nth-child(5) { animation-delay: 200ms; }

    /* â”€â”€ Chore confetti particle â”€â”€ */
    @keyframes confetti-fall { 0% { opacity:1; transform:translateY(0) rotate(0deg); } 100% { opacity:0; transform:translateY(60px) rotate(360deg); } }
    .confetti-dot { position:fixed; width:8px; height:8px; border-radius:50%; pointer-events:none; z-index:9999; animation: confetti-fall .8s ease-out forwards; }

    /* â”€â”€ Skeleton shimmer â”€â”€ */
    @keyframes shimmer { 0%{background-position:-200% 0} 100%{background-position:200% 0} }
    .skeleton {
      background: linear-gradient(90deg, #1E2738 25%, #253048 50%, #1E2738 75%);
      background-size: 200% 100%;
      animation: shimmer 1.5s infinite;
      border-radius: .5rem;
    }
    .skeleton-text { height: 1em; margin-bottom: .5rem; }
    .skeleton-block { height: 80px; }

    /* â”€â”€ Weather icon pulse â”€â”€ */
    @keyframes icon-pulse { 0%,100%{transform:scale(1)} 50%{transform:scale(1.08)} }
    .weather-icon-animated { display:inline-block; animation: icon-pulse 3s ease-in-out infinite; }

    /* â”€â”€ Lock screen glass â”€â”€ */
    .glass-panel {
      background: rgba(15, 20, 40, 0.72);
      backdrop-filter: blur(20px) saturate(180%);
      border: 1px solid rgba(255,255,255,.08);
    }

    /* â”€â”€ Touchscreen mode â”€â”€ */
    .touchscreen-mode .btn { padding: .75rem 1.25rem; font-size: 1.1rem; }
    .touchscreen-mode .card { padding: 1.75rem; }
    .touchscreen-mode .card:hover { transform: none; box-shadow: none; }
    body.reduce-motion * { animation: none !important; transition-duration: .01ms !important; }

    /* â”€â”€ Bento grid dashboard â”€â”€ */
    .bento-grid {
      display: grid;
      gap: 1.25rem;
      grid-template-columns: 1fr;
    }
    @media (min-width: 640px) {
      .bento-grid { grid-template-columns: repeat(2, 1fr); }
      .bento-span-2 { grid-column: span 2; }
    }
    @media (min-width: 1024px) {
      .bento-grid { grid-template-columns: repeat(3, 1fr); }
      .bento-span-2 { grid-column: span 2; }
      .bento-span-3 { grid-column: span 3; }
      .bento-tall   { grid-row: span 2; }
    }

    /* â”€â”€ Tomorrow weather in standby â”€â”€ */
    .standby-alert-strip {
      background: rgba(239,68,68,.85);
      border-radius: .5rem;
      padding: .4rem .75rem;
      font-size: .78rem;
      font-weight: 600;
      overflow: hidden;
      white-space: nowrap;
    }
    @keyframes marquee { from{transform:translateX(0)} to{transform:translateX(-50%)} }
    .marquee-text { display:inline-block; animation: marquee 12s linear infinite; }

    /* Responsive utilities */
    @media (max-width: 640px) {
      .card { padding: 1rem; margin-bottom: 1rem; }
      .standby-clock { font-size: 4rem !important; }
    }

    /* â”€â”€ Smooth scrolling â”€â”€ */
    html { scroll-behavior: smooth; }

    /* â”€â”€ Accordion for settings â”€â”€ */
    .accordion-body { max-height: 0; overflow: hidden; transition: max-height .35s ease; }
    .accordion-body.open { max-height: 2000px; }
    .accordion-toggle { cursor: pointer; user-select: none; }
    .accordion-toggle::after { content: ' â–¼'; font-size:.7em; transition:transform .2s; display:inline-block; }
    .accordion-toggle.open::after { transform: rotate(180deg); }

    /* â”€â”€ Performance: GPU-hint scroll containers â”€â”€ */
    .page { contain: layout style; }
    .card { contain: layout; }
    img   { content-visibility: auto; }

    /* â”€â”€ Touchscreen mode â€” larger hit areas â”€â”€ */
    .touchscreen-mode .btn { min-height: 52px; min-width: 52px; font-size: 1.05rem; }
    .touchscreen-mode .card { margin-bottom: 1.25rem; }
    body:not(.touchscreen-mode) .card:hover { transform: translateY(-3px); box-shadow: 0 8px 24px rgba(0,0,0,.35); }

    /* â”€â”€ Three-finger-tap hint â”€â”€ */
    #adminQuickFab {
      position: fixed; bottom: 1.5rem; right: 1.5rem; z-index: 9000;
      width: 52px; height: 52px; border-radius: 50%;
      background: rgba(239,68,68,.85); border: 1px solid rgba(255,255,255,.2);
      display: flex; align-items: center; justify-content: center;
      font-size: 1.4rem; cursor: pointer; box-shadow: 0 4px 16px rgba(0,0,0,.5);
      transition: transform .2s, opacity .2s;
    }
    #adminQuickFab:active { transform: scale(0.9); }

    /* â”€â”€ Grocery list â”€â”€ */
    #groceryList .card { transition: opacity .2s; }

    /* â”€â”€ On-screen keyboard key active â”€â”€ */
    #oskOverlay button:active { filter: brightness(1.4); transform: scale(0.95); }

    /* â”€â”€ Admin panel grid tiles â”€â”€ */
    #adminPanelContent .card { transition: background .15s, transform .1s; }
    #adminPanelContent .card:active { transform: scale(0.96); }
    /* â”€â”€ Player visualizer â”€â”€ */
    @keyframes vizBar {
      from { height: 3px; opacity: .5; }
      to   { height: 16px; opacity: 1; }
    }
    /* â”€â”€ Marquee for long track titles â”€â”€ */
    @keyframes marquee {
      0%   { transform: translateX(0); }
      100% { transform: translateX(-50%); }
    }
    /* â”€â”€ Chore SVG check transition â”€â”€ */
    .chore-check-svg { transition: transform .2s cubic-bezier(0.34,1.56,0.64,1); }
    .chore-card { transition: opacity .3s, background .3s; }
  </style>
</head>
<body>
  <div id="app">
    <!-- Loading Screen -->
    <div id="loadingScreen" class="min-h-screen flex items-center justify-center">
      <div class="text-center">
        <div class="animate-spin rounded-full h-16 w-16 border-b-4 border-blue-500 mx-auto mb-4"></div>
        <p class="text-xl text-gray-400" id="loadingText">Loading Home Hubâ€¦</p>
      </div>
    </div>
    <script>
      // Instant check: does localStorage have a saved Supabase session?
      try {
        const key = Object.keys(localStorage).find(k => k.startsWith('sb-') && k.endsWith('-auth-token'));
        if (key) {
          const stored = JSON.parse(localStorage.getItem(key));
          const email = stored?.user?.email;
          const el = document.getElementById('loadingText');
          if (email && el) el.textContent = 'Welcome back, ' + email.split('@')[0] + '! Signing inâ€¦';
        }
      } catch (e) { /* ignore */ }
    </script>

    <!-- Login Screen -->
    <div id="loginScreen" class="page min-h-screen flex items-center justify-center">
      <div class="card max-w-md w-full text-center mx-4">
        <h1 class="text-5xl font-bold mb-4">ğŸ  Home Hub</h1>
        <p class="text-gray-400 mb-8">Your family command center</p>
        <button id="btnGoogleLogin" class="btn btn-primary w-full text-lg py-3">Sign in with Google</button>
        <p class="text-xs text-gray-500 mt-4">
          By signing in, you agree to our 
          <a href="/tos.html" target="_blank" class="text-blue-400 hover:text-blue-300 underline">Terms of Service</a> and 
          <a href="/privacy.html" target="_blank" class="text-blue-400 hover:text-blue-300 underline">Privacy Policy</a>
        </p>
        <button id="btnCheckSupabase" class="btn btn-secondary w-full text-sm py-2 mt-4">ğŸ” Check Supabase</button>
        <pre id="debugOutput" style="display:none; text-align:left; font-size:0.7rem; line-height:1.4; background:#0f172a; color:#94a3b8; padding:1rem; border-radius:0.5rem; margin-top:1rem; max-height:400px; overflow:auto; white-space:pre-wrap; word-break:break-all;"></pre>
      </div>
    </div>

    <!-- Access Denied Screen -->
    <div id="accessDeniedScreen" class="page min-h-screen flex items-center justify-center">
      <div class="card max-w-md w-full text-center mx-4">
        <div class="text-7xl mb-6">ğŸš«</div>
        <h1 class="text-4xl font-bold mb-4">Access Denied</h1>
        <p class="text-gray-400 mb-4">Your account is not authorized.</p>
        <p class="text-gray-500 text-sm mb-8" id="deniedEmail"></p>
        <button id="btnSignOutDenied" class="btn btn-secondary w-full">Sign Out</button>
      </div>
    </div>

    <!-- Alert Banner (fixed top) -->
    <div id="alertBanner" class="alert-banner hidden"></div>

    <!-- Alert Popup Modal -->
    <div id="alertPopup" class="modal-overlay hidden">
      <div class="card max-w-2xl w-full text-center">
        <div class="text-7xl mb-4">âš ï¸</div>
        <h2 class="text-3xl font-bold mb-4">Weather Alert</h2>
        <p id="alertPopupText" class="text-xl mb-6"></p>
        <button id="btnDismissAlert" class="btn btn-primary px-8 py-3">Acknowledged</button>
      </div>
    </div>

    <!-- ========== DASHBOARD ========== -->
    <div id="dashboardPage" class="page">
      <div class="max-w-7xl mx-auto p-4 md:p-6">
        <!-- Header -->
        <header class="mb-8 flex flex-col sm:flex-row sm:items-start sm:justify-between gap-4">
          <div>
            <h1 class="text-4xl md:text-5xl font-bold">ğŸ  Home Hub</h1>
            <p class="text-gray-400 mt-2 text-base" id="dashboardDate"></p>
            <p class="text-blue-400 text-base mt-1" id="dashboardGreeting"></p>
          </div>
          <div class="flex flex-wrap gap-2">
            <button onclick="Hub.router.go('standby')" class="btn btn-secondary text-sm py-2 px-4">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><rect x="2" y="3" width="20" height="14" rx="2"/><path d="M8 21h8M12 17v4"/></svg>
              Standby
            </button>
            <button onclick="Hub.router.go('status')" class="btn btn-secondary text-sm py-2 px-4">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>
              Status
            </button>
            <button onclick="Hub.router.go('settings')" class="btn btn-secondary text-sm py-2 px-4">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
              Settings
            </button>
            <button onclick="Hub.router.go('music')" class="btn btn-secondary text-sm py-2 px-4">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M9 18V5l12-2v13"/><circle cx="6" cy="18" r="3"/><circle cx="18" cy="16" r="3"/></svg>
              Music
            </button>
            <button onclick="Hub.router.go('radio')" class="btn btn-secondary text-sm py-2 px-4">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M3 17l9-9 9 9"/><rect x="5" y="17" width="14" height="4" rx="1"/></svg>
              Radio
            </button>
            <button onclick="Hub.router.go('grocery')" class="btn btn-secondary text-sm py-2 px-4">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"/><line x1="3" y1="6" x2="21" y2="6"/><path d="M16 10a4 4 0 0 1-8 0"/></svg>
              Grocery
            </button>
            <button id="btnSignOut" class="btn btn-secondary text-sm py-2 px-4">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
              Sign Out
            </button>
          </div>
        </header>

        <!-- Bento Grid Dashboard -->
        <div class="bento-grid">

          <!-- Calendar Widget â€” spans 2 cols on tablet+ -->
          <div class="card card-enter bento-span-2">
            <div id="calendarWidget">
              <div class="skeleton skeleton-block mb-2"></div>
              <div class="skeleton skeleton-text" style="width:70%"></div>
            </div>
          </div>

          <!-- Weather Card -->
          <div class="card card-enter">
            <div class="flex items-center justify-between mb-4">
              <h2 class="text-xl font-bold">â˜€ï¸ Weather</h2>
              <button onclick="Hub.router.go('weather')" class="text-blue-400 hover:text-blue-300 text-sm">
                Full Forecast â†’
              </button>
            </div>
            <div id="dashboardWeather">
              <div class="skeleton skeleton-text" style="width:80%"></div>
              <div class="skeleton skeleton-text" style="width:60%"></div>
            </div>
          </div>

          <!-- Dog Treat Status Widget -->
          <div class="card card-enter">
            <div class="flex items-center justify-between mb-4">
              <h3 class="font-bold text-xl">ğŸ• Barker</h3>
              <button onclick="Hub.treats.showQuickAdd()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm rounded-lg font-semibold transition-colors">
                + Treat
              </button>
            </div>
            <div id="dogStatusWidget">
              <div class="skeleton skeleton-block"></div>
            </div>
          </div>

          <!-- Chores Preview -->
          <div class="card card-enter">
            <div class="flex items-center justify-between mb-4">
              <h2 class="text-xl font-bold">Today's Chores</h2>
              <button onclick="Hub.router.go('chores')" class="text-blue-400 hover:text-blue-300 text-sm">
                View All â†’
              </button>
            </div>
            <div id="dashboardChores" class="space-y-2">
              <div class="skeleton skeleton-text"></div>
              <div class="skeleton skeleton-text" style="width:85%"></div>
              <div class="skeleton skeleton-text" style="width:70%"></div>
            </div>
          </div>

          <!-- Now Playing Widget -->
          <div class="card card-enter">
            <h2 class="text-xl font-bold mb-4">ğŸµ Now Playing</h2>
            <div id="nowPlayingWidget"></div>
          </div>

          <!-- Photos Widget â€” full width -->
          <div class="card card-enter bento-span-3">
            <div class="flex items-center justify-between mb-4">
              <h3 class="font-bold text-xl">ğŸ“¸ Family Photos</h3>
            </div>
            <div id="immichDashboardWidget" class="min-h-[200px]">
              <div class="grid grid-cols-3 gap-2">
                <div class="skeleton" style="aspect-ratio:16/9;border-radius:.5rem;"></div>
                <div class="skeleton" style="aspect-ratio:16/9;border-radius:.5rem;"></div>
                <div class="skeleton" style="aspect-ratio:16/9;border-radius:.5rem;"></div>
              </div>
            </div>
          </div>

        </div><!-- end bento-grid -->
      </div>
    </div>

    <!-- ========== STANDBY ========== -->
    <div id="standbyPage" class="page min-h-screen bg-black text-white relative overflow-hidden cursor-pointer">
      <!-- Full screen photo background - two-layer RAF crossfade -->
      <div id="standbyPhotoBackground" class="absolute inset-0">
        <img id="slideshowLayerA" class="slideshow-layer" alt="" style="opacity:0;z-index:2;" />
        <img id="slideshowLayerB" class="slideshow-layer" alt="" style="opacity:0;z-index:1;" />
      </div>
      
      <!-- Dark overlay for readability -->
      <div class="absolute inset-0 bg-gradient-to-t from-black via-transparent to-black/20"></div>
      
      <!-- Content overlay - responsive -->
      <div class="relative z-10 min-h-screen p-4 sm:p-6 md:p-8 flex flex-col justify-end" id="standbyContent">
        
        <!-- Time and Date - Bottom Left Corner -->
        <div class="mb-4">
          <!-- Clock -->
          <div id="standbyClock" class="text-5xl sm:text-6xl md:text-7xl font-bold tracking-tight mb-1"></div>
          <!-- Date -->
          <div id="standbyDate" class="text-base sm:text-lg md:text-xl text-gray-300 font-light"></div>
        </div>

        <!-- Info Cards â€” single horizontal row -->
        <div class="w-full max-w-6xl mb-4" style="display:grid;grid-template-columns:repeat(4,1fr);gap:.75rem;">

          <!-- 1 Â· Calendar -->
          <div class="glass-panel rounded-xl p-3 min-w-0">
            <h3 class="text-xs font-semibold mb-1 text-blue-400 uppercase tracking-wide">ğŸ“… Upcoming</h3>
            <div id="standbyCalendar" class="space-y-1 text-xs max-h-28 overflow-hidden">
              <p class="text-gray-400">Loading...</p>
            </div>
          </div>

          <!-- 2 Â· Chores -->
          <div class="glass-panel rounded-xl p-3 min-w-0">
            <h3 class="text-xs font-semibold mb-1 text-green-400 uppercase tracking-wide">âœ… Chores</h3>
            <div id="standbyChores" class="space-y-1 text-xs max-h-28 overflow-hidden">
              <p class="text-gray-400">Loading...</p>
            </div>
          </div>

          <!-- 3 Â· Weather -->
          <div class="glass-panel rounded-xl p-3 min-w-0">
            <h3 class="text-xs font-semibold mb-1 text-yellow-400 uppercase tracking-wide">ğŸŒ¤ï¸ Weather</h3>
            <div id="standbyWeather" class="text-xs">
              <p class="text-gray-400">Loading...</p>
            </div>
            <div id="standbyTomorrow" class="text-xs text-gray-400 mt-1 hidden"></div>
            <div id="standbyAlertStrip" class="standby-alert-strip mt-1 hidden"></div>
          </div>

          <!-- 4 Â· Now Playing -->
          <div class="glass-panel rounded-xl p-3 min-w-0 flex flex-col justify-center">
            <h3 class="text-xs font-semibold mb-1 text-purple-400 uppercase tracking-wide">ğŸµ Now Playing</h3>
            <div id="standbyNowPlaying" class="text-xs">
              <p class="text-gray-400">Nothing playing</p>
            </div>
          </div>

        </div>

        <!-- Tap to wake hint - always at very bottom -->
        <div class="text-center mt-4 sm:mt-6">
          <p class="text-gray-500 text-xs">Tap anywhere to wake</p>
        </div>

      </div>
    </div>

    <!-- ========== WEATHER ========== -->
    <div id="weatherPage" class="page">
      <div class="max-w-7xl mx-auto p-4 md:p-6">
        <header class="flex items-center justify-between mb-6">
          <h1 class="text-3xl font-bold">ğŸŒ¤ï¸ Weather Center</h1>
          <button onclick="Hub.router.go('dashboard')" class="btn btn-secondary">â† Back</button>
        </header>
        <div id="weatherContent"><p class="text-gray-400">Loading detailed weatherâ€¦</p></div>
        <div class="card mt-6">
          <h2 class="text-xl font-bold mb-4">ğŸŒ§ Rain Radar</h2>
          <div id="rainRadar" class="bg-gray-800 rounded-lg p-4 text-center">
            <p class="text-gray-400 text-sm">Loading radarâ€¦</p>
          </div>
        </div>
      </div>
    </div>

    <!-- ========== CHORES ========== -->
    <div id="choresPage" class="page">
      <div class="max-w-7xl mx-auto p-4 md:p-6">
        <header class="flex items-center justify-between mb-6">
          <h1 class="text-3xl font-bold">âœ… Chores</h1>
          <div class="flex gap-3">
            <button id="btnAddChore" class="btn btn-primary">+ Add Chore</button>
            <button onclick="Hub.router.go('dashboard')" class="btn btn-secondary">â† Back</button>
          </div>
        </header>
        <div id="choresList"></div>
      </div>
    </div>

    <!-- ========== TREATS ========== -->
    <div id="treatsPage" class="page">
      <div class="max-w-7xl mx-auto p-4 md:p-6">
        <header class="flex items-center justify-between mb-6">
          <h1 class="text-3xl font-bold">ğŸ• Dog Treats</h1>
          <button onclick="Hub.router.go('dashboard')" class="btn btn-secondary">â† Back</button>
        </header>
        <div id="dogSelector" class="mb-6"></div>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <div class="card md:col-span-2">
            <h2 class="text-2xl font-bold mb-4" id="selectedDogName">Select a dog</h2>
            <div id="calorieProgress" class="mb-6"></div>
            <div id="todayTreats"></div>
            <div id="weekHistory" class="mt-6"></div>
          </div>
          <div class="card">
            <button id="btnAddTreat" class="btn btn-primary w-full mb-4">+ Log Treat</button>
            <button id="btnAddDog" class="btn btn-secondary w-full">+ Add Dog</button>
          </div>
        </div>
      </div>
    </div>

    <!-- ========== STATUS ========== -->
    <div id="statusPage" class="page">
      <div class="max-w-4xl mx-auto p-4 md:p-6">
        <header class="flex items-center justify-between mb-6">
          <h1 class="text-3xl font-bold">ğŸ“Š System Status</h1>
          <div class="flex gap-3">
            <button id="btnRefreshStatus" class="btn btn-primary">Refresh</button>
            <button onclick="Hub.router.go('dashboard')" class="btn btn-secondary">â† Back</button>
          </div>
        </header>
        <div id="statusContent"><p class="text-gray-400">Checking servicesâ€¦</p></div>
      </div>
    </div>

    <!-- ========== SETTINGS ========== -->
<!-- ========== CONTROL / ADMIN PANEL ========== -->
<!-- Add this BEFORE the settingsPage section in your index.html -->

    <div id="controlPage" class="page">
      <div class="max-w-4xl mx-auto p-4 md:p-6">
        <header class="flex items-center justify-between mb-6">
          <h1 class="text-3xl font-bold">ğŸ›°ï¸ Site Control Center</h1>
          <button onclick="Hub.router.go('dashboard')" class="btn btn-secondary">â† Back</button>
        </header>

        <div id="controlAdminGate" class="card mb-6 hidden">
          <h2 class="text-xl font-bold mb-2">ğŸ”’ Admin only</h2>
          <p class="text-gray-400 text-sm">This page is restricted to household admins.</p>
        </div>

        <div id="controlContent" class="space-y-6">
          <!-- Admin controls will be added here by control.js -->
          
          <!-- Original Site Control Features -->
          <div class="card">
            <div class="flex items-center justify-between gap-4 mb-4">
              <h2 class="text-xl font-bold">Remote Banner & Maintenance</h2>
              <span class="text-xs text-gray-500">Controls a different site via Supabase</span>
            </div>

            <div class="space-y-4">
              <div>
                <label class="block text-sm font-medium mb-2">Site Name (key)</label>
                <input id="controlSiteName" type="text" class="input" placeholder="main" value="main">
                <p class="text-xs text-gray-500 mt-1">Use multiple names if you want multiple controlled sites.</p>
              </div>

              <div>
                <label class="block text-sm font-medium mb-2">Controlled Site Base URL (optional)</label>
                <input id="controlBaseUrl" type="url" class="input" placeholder="https://example.com">
              </div>

              <div class="flex items-center gap-3">
                <input id="controlMaintenance" type="checkbox" class="w-4 h-4">
                <label for="controlMaintenance" class="text-sm font-medium">Maintenance mode</label>
                <span class="text-xs text-gray-500">(your other site can hide features)</span>
              </div>

              <div>
                <label class="block text-sm font-medium mb-2">Banner message</label>
                <input id="controlBannerMessage" type="text" class="input" placeholder="We'll be back soonâ€¦">
              </div>

              <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-medium mb-2">Banner severity</label>
                  <select id="controlBannerSeverity" class="input">
                    <option value="info">Info</option>
                    <option value="warning">Warning</option>
                    <option value="critical">Critical</option>
                  </select>
                </div>
                <div class="flex items-center gap-3 mt-7 sm:mt-0 sm:items-end">
                  <input id="controlPublicRead" type="checkbox" class="w-4 h-4">
                  <label for="controlPublicRead" class="text-sm font-medium">Public read</label>
                </div>
              </div>

              <div>
                <label class="block text-sm font-medium mb-2">Disabled paths (one per line)</label>
                <textarea id="controlDisabledPaths" class="input" rows="5" placeholder="/games\n/admin\n/some-page"></textarea>
                <p class="text-xs text-gray-500 mt-1">Your other site can block or hide these pages/links.</p>
              </div>

              <div class="flex flex-wrap gap-3">
                <button id="btnControlLoad" class="btn btn-secondary">Reload</button>
                <button id="btnControlSave" class="btn btn-primary">ğŸ’¾ Save</button>
              </div>
              <p id="controlStatus" class="text-xs text-gray-500"></p>
            </div>
          </div>

          <div class="card">
            <div class="flex items-center justify-between mb-3">
              <h2 class="text-xl font-bold">JSON Preview</h2>
              <button id="btnControlCopyJson" class="btn btn-secondary text-sm">Copy</button>
            </div>
            <pre id="controlJsonPreview" class="bg-gray-900 rounded-lg p-4 text-xs overflow-auto max-h-64">Loadingâ€¦</pre>
          </div>

          <div class="card">
            <h2 class="text-xl font-bold mb-3">Integration Snippet (paste into your other site)</h2>
            <pre id="controlSnippet" class="bg-gray-900 rounded-lg p-4 text-xs overflow-auto">Loadingâ€¦</pre>
            <p class="text-xs text-gray-500 mt-2">If this page says the table is missing, run the new SQL migration in this repo.</p>
          </div>
        </div>
      </div>
    </div>

    <div id="settingsPage" class="page">
      <div class="max-w-4xl mx-auto p-4 md:p-6">
        <header class="flex items-center justify-between mb-6">
          <h1 class="text-3xl font-bold">âš™ï¸ Settings</h1>
          <button onclick="Hub.router.go('dashboard')" class="btn btn-secondary">â† Back</button>
        </header>
        <div class="space-y-6">
          <!-- Location -->
          <div class="card">
            <h2 class="text-xl font-bold mb-4">ğŸ“ Location</h2>
            <div class="space-y-4">
              <div><label class="block text-sm font-medium mb-2">Location Name</label><input id="settingLocationName" type="text" class="input" placeholder="Home"></div>
              <div class="grid grid-cols-2 gap-4">
                <div><label class="block text-sm font-medium mb-2">Latitude</label><input id="settingLat" type="number" step="0.000001" class="input"></div>
                <div><label class="block text-sm font-medium mb-2">Longitude</label><input id="settingLon" type="number" step="0.000001" class="input"></div>
              </div>
              <button id="btnUseLocation" class="btn btn-secondary text-sm">ğŸ“ Use Current Location</button>
            </div>
          </div>
          <!-- Standby Photos -->
          <div class="card">
            <h2 class="text-xl font-bold mb-4">
              <svg style="display:inline;vertical-align:-.1em;margin-right:.4em" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>
              Standby Photos
            </h2>
            <div class="space-y-4">
              <div>
                <label class="block text-sm font-medium mb-2">Photo Source</label>
                <select id="settingPhotoProvider" class="input">
                  <option value="imgur">Imgur Album</option>
                  <option value="google">Google Photos Album</option>
                  <option value="immich">Immich (local NAS)</option>
                  <option value="off">Off (placeholders)</option>
                </select>
              </div>

              <!-- Google Photos settings -->
              <div id="photoSettingsGoogle" style="display:none;" class="space-y-3 border-l-2 border-blue-600 pl-4">
                <p class="text-xs text-blue-400">Uses your Google account â€” no extra sign-in needed</p>
                <div>
                  <label class="block text-sm font-medium mb-2">Album</label>
                  <div class="flex gap-2 mb-2">
                    <button id="btnLoadGoogleAlbums" class="btn btn-secondary text-sm">Load My Albums</button>
                    <button id="btnTestSlideshow" class="btn btn-secondary text-sm">Test Slideshow</button>
                  </div>
                  <select id="settingGooglePhotosAlbumSelect" class="input mb-2">
                    <option value="">â€” click Load My Albums first â€”</option>
                  </select>
                  <input id="settingGooglePhotosAlbumId" type="hidden">
                  <input id="settingGooglePhotosAlbumTitle" type="text" class="input text-xs text-gray-400" placeholder="Album title (auto-filled)" readonly>
                </div>
                <p class="text-xs text-gray-500">If photos stop working, sign out and back in to re-grant Photos permission.</p>
              </div>

              <!-- Imgur settings -->
              <div id="photoSettingsImgur" class="space-y-3 border-l-2 border-orange-500 pl-4">
                <p class="text-xs text-orange-400">Public Imgur album â€” no account needed</p>
                <div>
                  <label class="block text-sm font-medium mb-2">Imgur Album ID</label>
                  <input id="settingImgurAlbum" type="text" class="input" placeholder="kAG2MS3">
                </div>
                <button id="btnTestSlideshow2" class="btn btn-secondary text-sm" onclick="Hub.app._testSlideshow()">Test Slideshow</button>
              </div>

              <!-- Immich settings -->
              <div id="photoSettingsImmich" style="display:none;" class="space-y-3 border-l-2 border-purple-500 pl-4">
                <p class="text-xs text-purple-400">Local Immich server â€” must be on same network</p>
                <div><label class="block text-sm font-medium mb-2">Immich Base URL</label><input id="settingImmichUrl" type="url" class="input" placeholder="http://192.168.1.100:2283"></div>
                <div><label class="block text-sm font-medium mb-2">API Key / Shared Token</label><input id="settingImmichKey" type="password" class="input" placeholder="Your Immich API key"></div>
                <div><label class="block text-sm font-medium mb-2">Album ID (optional)</label><input id="settingImmichAlbum" type="text" class="input" placeholder="Shared album ID or leave blank for library"></div>
              </div>
            </div>
          </div>
          <!-- Standby -->
          <div class="card">
            <h2 class="text-xl font-bold mb-4">ğŸ’¤ Standby Mode</h2>
            <div class="space-y-4">
              <div><label class="block text-sm font-medium mb-2">Auto-enter after (minutes)</label><input id="settingIdleTimeout" type="number" class="input" value="10" min="1" max="60"></div>
              <div class="grid grid-cols-2 gap-4">
                <div><label class="block text-sm font-medium mb-2">Quiet Hours Start</label><input id="settingQuietStart" type="time" class="input" value="22:00"></div>
                <div><label class="block text-sm font-medium mb-2">Quiet Hours End</label><input id="settingQuietEnd" type="time" class="input" value="07:00"></div>
              </div>
            </div>
          </div>
          <!-- Calendar Selection -->
          <div class="card">
            <h2 class="text-xl font-bold mb-4">ğŸ“… Calendar Selection</h2>
            <div id="calendarSelectionContainer">
              <p class="text-gray-400 text-sm mb-3">Choose which Google Calendars to display on your dashboard</p>
              <button id="btnLoadCalendars" class="btn btn-secondary text-sm mb-3">Load My Calendars</button>
              <div id="calendarCheckboxes" class="space-y-2"></div>
            </div>
          </div>
          
          <!-- Changelog -->
          <div class="card">
            <h2 class="text-xl font-bold mb-4">ğŸ“‹ What's New</h2>
            <div class="space-y-3 text-sm">
              <div class="border-l-4 border-blue-500 pl-4 py-2">
                <p class="font-semibold text-blue-400">v2.0.0 - February 9, 2026</p>
                <ul class="list-disc pl-5 mt-2 space-y-1 text-gray-400">
                  <li>âœ¨ Multi-calendar selection - choose which calendars to display</li>
                  <li>ğŸ“… Automatic Google Calendar permission requests</li>
                  <li>ğŸ‘¤ Personalization - greetings and chore attribution</li>
                  <li>ğŸŒ¤ï¸ Redesigned weather center with animated radar</li>
                  <li>ğŸ¨ Color-coded calendar indicators</li>
                  <li>ğŸ’¾ Settings now persist forever</li>
                </ul>
              </div>
              <div class="border-l-4 border-gray-500 pl-4 py-2">
                <p class="font-semibold text-gray-300">v1.5.0 - February 8, 2026</p>
                <ul class="list-disc pl-5 mt-2 space-y-1 text-gray-400">
                  <li>Fixed navigation tabs</li>
                  <li>Added standby mode improvements</li>
                  <li>Google Calendar integration</li>
                </ul>
              </div>
              <div class="border-l-4 border-gray-500 pl-4 py-2">
                <p class="font-semibold text-gray-300">v1.0.0 - January 2026</p>
                <ul class="list-disc pl-5 mt-2 space-y-1 text-gray-400">
                  <li>Initial release</li>
                  <li>Chores tracking</li>
                  <li>Dog treat tracker</li>
                  <li>Weather integration</li>
                </ul>
              </div>
            </div>
          </div>

          <!-- Legal & Privacy -->
          <div class="card bg-gray-800">
            <h2 class="text-xl font-bold mb-4">âš–ï¸ Legal & Privacy</h2>
            <div class="space-y-3 text-sm">
              <p class="text-gray-400">Your settings and data are stored securely and persist indefinitely while your account is active.</p>
              <div class="flex flex-wrap gap-4">
                <a href="/privacy.html" target="_blank" class="text-blue-400 hover:text-blue-300 underline">
                  ğŸ“œ Privacy Policy
                </a>
                <a href="/tos.html" target="_blank" class="text-blue-400 hover:text-blue-300 underline">
                  ğŸ“‹ Terms of Service
                </a>
                <a href="https://myaccount.google.com/permissions" target="_blank" class="text-blue-400 hover:text-blue-300 underline">
                  ğŸ” Manage Google Permissions
                </a>
              </div>
              <p class="text-xs text-gray-500 mt-3">
                Home Hub uses Google Calendar API. By using calendar features, you agree to our Terms of Service and Privacy Policy, 
                and acknowledge our compliance with <a href="https://developers.google.com/terms/api-services-user-data-policy" target="_blank" class="text-blue-400 hover:text-blue-300 underline">Google API Services User Data Policy</a>.
              </p>
            </div>
          </div>

          <!-- Touchscreen Mode -->
          <div class="card">
            <h2 class="text-xl font-bold mb-4 accordion-toggle" onclick="Hub.ui.toggleAccordion(this)">ğŸ“± Touchscreen Mode</h2>
            <div class="accordion-body">
              <div class="space-y-4">
                <label class="flex items-center justify-between cursor-pointer">
                  <span class="text-sm font-medium">Larger UI density</span>
                  <input type="checkbox" id="tsLargerUI" class="w-5 h-5 rounded" onchange="Hub.ui.applyTouchscreenMode()">
                </label>
                <label class="flex items-center justify-between cursor-pointer">
                  <span class="text-sm font-medium">Disable hover states</span>
                  <input type="checkbox" id="tsDisableHover" class="w-5 h-5 rounded" onchange="Hub.ui.applyTouchscreenMode()">
                </label>
                <label class="flex items-center justify-between cursor-pointer">
                  <span class="text-sm font-medium">Increase button hit areas</span>
                  <input type="checkbox" id="tsLargeHits" class="w-5 h-5 rounded" onchange="Hub.ui.applyTouchscreenMode()">
                </label>
                <label class="flex items-center justify-between cursor-pointer">
                  <span class="text-sm font-medium">Reduce motion (performance)</span>
                  <input type="checkbox" id="tsReduceMotion" class="w-5 h-5 rounded" onchange="Hub.ui.applyTouchscreenMode()">
                </label>
                <p class="text-xs text-gray-500">Touchscreen mode optimises the UI for kiosk/Pi use.</p>
              </div>
            </div>
          </div>

          <!-- Fullscreen Controls -->
          <div class="card">
            <h2 class="text-xl font-bold mb-4">ğŸ–¥ Fullscreen</h2>
            <div class="flex gap-3">
              <button onclick="Hub.ui.enterFullscreen()" class="btn btn-primary flex-1">â›¶ Enter Fullscreen</button>
              <button onclick="Hub.ui.exitFullscreen()" class="btn btn-secondary flex-1">âœ• Exit Fullscreen</button>
            </div>
            <p id="fullscreenStatus" class="text-xs text-gray-500 mt-2 text-center"></p>
          </div>

          <!-- Admin Panel â€” button shown/hidden based on role by _loadSettingsForm() -->
          <div id="settingsAdminCard" class="card" style="border:1px solid rgba(239,68,68,.3);background:rgba(239,68,68,.05);">
            <div class="flex items-center justify-between">
              <div>
                <h2 class="text-xl font-bold">ğŸ›  Admin Panel</h2>
                <p class="text-gray-400 text-sm mt-1">Live control console â€” system, media, display, debug, simulation</p>
              </div>
              <div id="settingsAdminBtn">
                <!-- Populated by _loadSettingsForm based on role -->
                <span class="text-gray-500 text-sm">Checking accessâ€¦</span>
              </div>
            </div>
          </div>

          <button id="btnSaveSettings" class="btn btn-primary w-full py-3">ğŸ’¾ Save All Settings</button>
          <p class="text-center text-sm text-gray-500 mt-2">Settings are automatically saved to your account and persist forever</p>
        </div>
      </div>
    </div>
  </div>

  <!-- ========== MODALS ========== -->
  <!-- Grocery: Confirm Clear All modal -->
  <div id="groceryClearModal" class="modal-overlay hidden">
    <div class="card max-w-sm w-full text-center">
      <p class="text-3xl mb-3">ğŸ—‘ï¸</p>
      <h2 class="text-xl font-bold mb-2">Clear All Groceries?</h2>
      <p class="text-gray-400 text-sm mb-6">This will delete every item from the household list. This cannot be undone.</p>
      <div class="flex gap-3">
        <button onclick="Hub.ui.closeModal('groceryClearModal')"
          class="btn btn-secondary flex-1">Cancel</button>
        <button onclick="Hub.grocery.confirmClearAllConfirmed()"
          class="btn btn-primary flex-1" style="background:#dc2626;">Yes, Clear All</button>
      </div>
    </div>
  </div>

  <div id="addDogModal" class="modal-overlay hidden">
    <div class="card max-w-lg w-full">
      <h2 class="text-2xl font-bold mb-4">Add Dog</h2>
      <div class="space-y-4">
        <input id="dogName" type="text" placeholder="Name" class="input">
        <input id="dogCalories" type="number" placeholder="Daily calorie limit" class="input" value="1000">
        <div class="flex gap-3">
          <button id="btnSaveDog" class="btn btn-primary flex-1">Add Dog</button>
          <button onclick="Hub.ui.closeModal('addDogModal')" class="btn btn-secondary">Cancel</button>
        </div>
      </div>
    </div>
  </div>

  <div id="addTreatModal" class="modal-overlay hidden">
    <div class="card max-w-lg w-full">
      <h2 class="text-2xl font-bold mb-4">Log Treat</h2>
      <div class="space-y-4">
        <input id="treatName" type="text" placeholder="Treat name" class="input">
        <input id="treatCalories" type="number" placeholder="Calories" class="input">
        <div class="flex gap-3">
          <button id="btnSaveTreat" class="btn btn-primary flex-1">Log Treat</button>
          <button onclick="Hub.ui.closeModal('addTreatModal')" class="btn btn-secondary">Cancel</button>
        </div>
      </div>
    </div>
  </div>

  <div id="addChoreModal" class="modal-overlay hidden">
    <div class="card max-w-lg w-full">
      <h2 class="text-2xl font-bold mb-4">Add Chore</h2>
      <div class="space-y-4">
        <input id="choreTitle" type="text" placeholder="Title" class="input">
        <textarea id="choreDescription" placeholder="Description (optional)" class="input" rows="3"></textarea>
        <select id="choreCategory" class="input">
          <option value="Daily">Daily</option>
          <option value="Monday (Living Room)">Monday (Living Room)</option>
          <option value="Tuesday (Bathrooms)">Tuesday (Bathrooms)</option>
          <option value="Wednesday (Entryway)">Wednesday (Entryway)</option>
          <option value="Thursday (Kitchen)">Thursday (Kitchen)</option>
          <option value="Friday (Bedrooms)">Friday (Bedrooms)</option>
          <option value="Saturday (Miscellaneous)">Saturday (Miscellaneous)</option>
          <option value="Sunday (Grocery/Family)">Sunday (Grocery/Family)</option>
        </select>
        <select id="chorePriority" class="input">
          <option value="low">Low Priority</option>
          <option value="medium" selected>Medium Priority</option>
          <option value="high">High Priority</option>
        </select>
        <div class="flex gap-3">
          <button id="btnSaveChore" class="btn btn-primary flex-1">Create Chore</button>
          <button onclick="Hub.ui.closeModal('addChoreModal')" class="btn btn-secondary">Cancel</button>
        </div>
      </div>
    </div>
  </div>


    <!-- ========== MUSIC PAGE ========== -->
    <div id="musicPage" class="page">
      <div class="max-w-4xl mx-auto p-4 md:p-6">
        <button onclick="Hub.router.go('dashboard')" class="btn btn-secondary mb-4">â† Back to Dashboard</button>
        <h1 class="text-3xl md:text-4xl font-bold mb-6">ğŸµ Music</h1>
        <div id="musicPlayerContainer"></div>
        <div id="bluetoothHelp" class="mt-6"></div>
      </div>
    </div>

    <!-- ========== RADIO PAGE ========== -->
    <div id="radioPage" class="page">
      <div class="max-w-4xl mx-auto p-4 md:p-6">
        <button onclick="Hub.router.go('dashboard')" class="btn btn-secondary mb-4">â† Back to Dashboard</button>
        <h1 class="text-3xl md:text-4xl font-bold mb-4">ğŸ“» Radio</h1>

        <!-- Full TuneIn site â€” browse and play all stations -->
        <div style="border-radius:1rem;overflow:hidden;height:72vh;min-height:480px;border:1px solid rgba(255,255,255,.1);">
          <iframe
            src="https://tunein.com"
            style="width:100%;height:100%;border:0;background:#111;"
            allow="autoplay; fullscreen; encrypted-media"
            sandbox="allow-scripts allow-same-origin allow-forms allow-popups allow-popups-to-escape-sandbox allow-presentation"
            loading="lazy"
            title="TuneIn Radio">
          </iframe>
        </div>
        <p class="text-xs text-gray-500 text-center mt-2 mb-4">Browse and play any station via TuneIn</p>

        <!-- Bluetooth audio output -->
        <div class="card">
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-3">
              <span class="text-2xl">ğŸ”µ</span>
              <div>
                <h3 class="font-semibold">Bluetooth Audio</h3>
                <p id="radioBtStatus" class="text-sm text-gray-400">No device connected</p>
              </div>
            </div>
            <button id="btnRadioBluetooth" onclick="Hub.radio.handleBluetooth()"
                    class="btn btn-secondary">Connect Bluetooth</button>
          </div>
        </div>
      </div>
    </div>

    <!-- ========== GROCERY LIST ========== -->
    <div id="groceryPage" class="page">
      <div class="max-w-2xl mx-auto p-4 md:p-6">
        <header class="flex items-center justify-between mb-6">
          <h1 class="text-3xl font-bold">ğŸ›’ Grocery List</h1>
          <button onclick="Hub.router.go('dashboard')" class="btn btn-secondary">â† Back</button>
        </header>
        <div id="groceryList">
          <p class="text-gray-400 text-center py-8">Loadingâ€¦</p>
        </div>
      </div>
    </div>

    <!-- ========== ADMIN PANEL ========== -->
    <div id="adminPage" class="page">
      <div class="max-w-4xl mx-auto p-4 md:p-6">
        <header class="flex items-center justify-between mb-6">
          <div>
            <h1 class="text-3xl font-bold">ğŸ›  Admin Panel</h1>
            <p class="text-gray-400 text-sm">Live control console Â· Tap = immediate effect</p>
          </div>
          <button onclick="Hub.router.go('settings')" class="btn btn-secondary">â† Settings</button>
        </header>
        <div id="adminPanelContent">
          <p class="text-gray-400 text-center py-8">Loading admin panelâ€¦</p>
        </div>
      </div>
    </div>


  <!-- Scripts (order matters) -->
  <script src="assets/utils.js"></script>
  <script src="assets/supabase.js"></script>
  <script src="assets/router.js"></script>
  <script src="assets/ui.js"></script>
  <script src="assets/weather.js"></script>
  <script src="assets/ai.js"></script>
  <script src="assets/calendar.js"></script>
  <script src="assets/treats.js"></script>
  <script src="assets/chores.js"></script>
  <script src="assets/control.js"></script>
  <script src="assets/grocery.js"></script>
  <script src="assets/standby.js"></script>
  <script src="assets/immich.js"></script>
  <script src="assets/googlePhotos.js"></script>
  <script src="assets/photos.js"></script>
  <script src="assets/player.js"></script>
  <script src="assets/radio.js"></script>
  <script src="assets/music.js"></script>
  <script src="assets/app.js"></script>

  <!-- Twemoji: replaces emoji characters with SVG images for Chromium/Pi kiosk compatibility -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/twemoji/14.0.2/twemoji.min.js" crossorigin="anonymous"></script>
  <script>
    // Parse only page headings and standby panel headers â€” not the full DOM (perf-safe)
    document.addEventListener('DOMContentLoaded', () => {
      const parseTargets = () => {
        // Standby panel headers, page headers, dashboard title
        document.querySelectorAll('.glass-panel h3, #dashboardPage h1, .page header h1, .card h2').forEach(el => {
          twemoji.parse(el, { folder: 'svg', ext: '.svg', base: 'https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/' });
        });
      };
      // Run after fonts load
      setTimeout(parseTargets, 500);
      // Re-run on navigation (router emits hashchange)
      window.addEventListener('hashchange', () => setTimeout(parseTargets, 300));
    });
  </script>

  <!-- Service Worker registration (PWA â€” no UI here, install UI lives in Admin Panel only) -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js').then(reg => {
          console.log('[SW] Registered, scope:', reg.scope);
        }).catch(err => console.warn('[SW] Registration failed:', err));
      });
    }
  </script>
</body>
</html>
