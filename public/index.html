<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Home Hub</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Supabase JS v2 -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <!-- Firebase compat SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.7.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.2/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.2/firebase-auth-compat.js"></script>

  <!-- Firebase Config for Dog Tracker -->
  <script>
    window.HOME_HUB_CONFIG = window.HOME_HUB_CONFIG || {};
    window.HOME_HUB_CONFIG.firebase = {
      apiKey: "AIzaSyBISAQF9xw2ifb9HllNj4LniyMLD6OhclU",
      authDomain: "dog-calorie-counter.firebaseapp.com",
      databaseURL: "https://dog-calorie-counter-default-rtdb.firebaseio.com",
      projectId: "dog-calorie-counter",
      storageBucket: "dog-calorie-counter.firebasestorage.app",
      messagingSenderId: "835874316228",
      appId: "1:835874316228:web:cbebd7e0ad3b071352ce91"
    };
  </script>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

  <!-- App config (must come before app scripts) -->
  <script src="config.js"></script>

  <style>
        :root {
      --bg-base: #0B0F19; --bg-surface-1: #151B2B; --bg-card: #1A2235;
      --accent-primary: #3B82F6; --accent-glow: rgba(59, 130, 246, 0.2);
    }
    @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes shimmer { 0% { background-position: -200% 0; } 100% { background-position: 200% 0; } }
    @keyframes kenBurns { 0% { transform: scale(1); } 50% { transform: scale(1.1) translate(-5%, -5%); } 100% { transform: scale(1); } }
    body { background: var(--bg-base); color: #f9fafb; font-family: 'Inter', system-ui, sans-serif; margin: 0; }
    .card { background: linear-gradient(145deg, var(--bg-surface-1), var(--bg-card)); border-radius: 1rem; padding: 1.5rem; margin-bottom: 1.5rem; box-shadow: 0 4px 6px rgba(0,0,0,.3); }
    .btn { padding: .5rem 1rem; border-radius: .5rem; font-weight: 500; cursor: pointer; transition: all .2s; border: none; display: inline-flex; align-items: center; gap: .4rem; }
    .btn-primary { background: #3b82f6; color: #fff; } .btn-primary:hover { background: #2563eb; }
    .btn-secondary { background: #374151; color: #fff; } .btn-secondary:hover { background: #4b5563; }
    .btn-danger { background: #ef4444; color: #fff; } .btn-danger:hover { background: #dc2626; }
    .btn-success { background: #10b981; color: #fff; } .btn-success:hover { background: #059669; }
    .input { background: #374151; border: 1px solid #4b5563; border-radius: .5rem; padding: .5rem 1rem; color: #fff; width: 100%; box-sizing: border-box; }
    .input:focus { outline: none; border-color: #3b82f6; }
    .hidden { display: none !important; }
    .page { display: none; } .page.active { display: block; }
    .standby-clock { font-variant-numeric: tabular-nums; letter-spacing: -.05em; }
    .photo-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1rem; }
    .photo-item { aspect-ratio: 16/9; background: #1f2937; border-radius: .5rem; overflow: hidden; }
    .photo-item img { width: 100%; height: 100%; object-fit: cover; transition: opacity 1s; }
    /* ‚îÄ‚îÄ Alert Banner ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    .alert-banner {
      position: fixed; top: 0; left: 0; right: 0; z-index: 9000;
      padding: .65rem 3.5rem .65rem 1.25rem;
      font-weight: 700; font-size: .925rem; letter-spacing: .01em;
      text-align: center;
      backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px);
      border-bottom: 2px solid rgba(255,255,255,.15);
      box-shadow: 0 4px 20px rgba(0,0,0,.5);
    }
    /* severity backgrounds */
    .alert-banner.extreme,
    .alert-banner.severe,
    .alert-banner.warning   { background: rgba(185,28,28,.92);  color: #fee2e2; border-color: rgba(239,68,68,.5); }
    .alert-banner.moderate  { background: rgba(154,52,18,.92);  color: #fed7aa; border-color: rgba(234,88,12,.5); }
    .alert-banner.watch     { background: rgba(146,64,14,.92);  color: #fef3c7; border-color: rgba(245,158,11,.5); }
    .alert-banner.minor,
    .alert-banner.advisory,
    .alert-banner.statement { background: rgba(133,100,4,.88);  color: #fef9c3; border-color: rgba(234,179,8,.5); }
    .alert-banner.info,
    .alert-banner.unknown   { background: rgba(30,58,138,.9);   color: #bfdbfe; border-color: rgba(59,130,246,.5); }
    /* close button */
    .alert-banner-close {
      position: absolute; top: 50%; right: .75rem; transform: translateY(-50%);
      background: rgba(255,255,255,.15); border: 1px solid rgba(255,255,255,.25);
      color: inherit; width: 1.8rem; height: 1.8rem;
      border-radius: .35rem; cursor: pointer; font-size: 1.1rem; line-height: 1;
      display: flex; align-items: center; justify-content: center;
      transition: background .15s;
    }
    .alert-banner-close:hover { background: rgba(255,255,255,.28); }
    /* icon in banner */
    .hh-icon { display: inline-block; }
    .status-dot { display: inline-block; width: .75rem; height: .75rem; border-radius: 50%; }
    .status-dot.green { background: #10b981; } .status-dot.red { background: #ef4444; } .status-dot.yellow { background: #f59e0b; }
    .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,.6); display: flex; align-items: center; justify-content: center; z-index: 60; padding: 1rem; }
    .progress-bar { height: 1rem; background: #374151; border-radius: 9999px; overflow: hidden; }
    .progress-fill { height: 100%; border-radius: 9999px; transition: width .4s; }
    select.input { appearance: auto; }
    
    /* Standby photo transitions */
    #standbyCurrentPhoto { transition: opacity 0.5s ease-in-out; }
    
    /* Responsive utilities */
    @media (max-width: 640px) {
      .card { padding: 1rem; margin-bottom: 1rem; }
      .standby-clock { font-size: 4rem !important; }
    }
  </style>
  <!-- One-time SW + cache purge (cleans up old service workers from previous deploys) -->
  <script>
    (function() {
      if (typeof localStorage !== 'undefined' && !localStorage.getItem('sw_purged_v2')) {
        if ('serviceWorker' in navigator) {
          navigator.serviceWorker.getRegistrations().then(function(regs) {
            regs.forEach(function(r) { r.unregister(); });
          });
        }
        if ('caches' in window) {
          caches.keys().then(function(keys) {
            keys.forEach(function(k) { caches.delete(k); });
          });
        }
        localStorage.setItem('sw_purged_v2', '1');
        // Reload once so we get fresh resources (only if we unregistered something)
        if ('serviceWorker' in navigator) {
          navigator.serviceWorker.getRegistrations().then(function(regs) {
            if (regs.length > 0) { window.location.reload(); }
          });
        }
      }
    })();
  </script>
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%233b82f6'%3E%3Cpath d='M2.25 12l8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25'/%3E%3C/svg%3E">
</head>
<body>
  <div id="app">
    <!-- Loading Screen -->
    <div id="loadingScreen" class="min-h-screen flex items-center justify-center">
      <div class="text-center">
        <div class="animate-spin rounded-full h-16 w-16 border-b-4 border-blue-500 mx-auto mb-4"></div>
        <p class="text-xl text-gray-400" id="loadingText">Loading Home Hub‚Ä¶</p>
      </div>
    </div>
    <script>
      // Instant check: does localStorage have a saved Supabase session?
      try {
        const key = Object.keys(localStorage).find(k => k.startsWith('sb-') && k.endsWith('-auth-token'));
        if (key) {
          const stored = JSON.parse(localStorage.getItem(key));
          const email = stored?.user?.email;
          const el = document.getElementById('loadingText');
          if (email && el) el.textContent = 'Welcome back, ' + email.split('@')[0] + '! Signing in‚Ä¶';
        }
      } catch (e) { /* ignore */ }
    </script>

    <!-- Login Screen -->
    <div id="loginScreen" class="page min-h-screen flex items-center justify-center">
      <div class="card max-w-md w-full text-center mx-4">
        <h1 class="text-5xl font-bold mb-4" style="display:flex;align-items:center;gap:.6rem;justify-content:center;"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round" style="width:48px;height:48px;color:#3b82f6" aria-hidden="true"><path d="M2.25 12l8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25"/></svg>Home Hub</h1>
        <p class="text-gray-400 mb-8">Your family command center</p>
        <button id="btnGoogleLogin" class="btn btn-primary w-full text-lg py-3">Sign in with Google</button>
        <p class="text-xs text-gray-500 mt-4">
          By signing in, you agree to our 
          <a href="/tos.html" target="_blank" class="text-blue-400 hover:text-blue-300 underline">Terms of Service</a> and 
          <a href="/privacy.html" target="_blank" class="text-blue-400 hover:text-blue-300 underline">Privacy Policy</a>
        </p>
        <button id="btnCheckSupabase" class="btn btn-secondary w-full text-sm py-2 mt-4"> Check Supabase</button>
        <pre id="debugOutput" style="display:none; text-align:left; font-size:0.7rem; line-height:1.4; background:#0f172a; color:#94a3b8; padding:1rem; border-radius:0.5rem; margin-top:1rem; max-height:400px; overflow:auto; white-space:pre-wrap; word-break:break-all;"></pre>
      </div>
    </div>

    <!-- Access Denied Screen -->
    <div id="accessDeniedScreen" class="page min-h-screen flex items-center justify-center">
      <div class="card max-w-md w-full text-center mx-4">
        <div class="mb-6" style="color:#ef4444"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round" class="hh-icon" style="width:64px;height:64px;vertical-align:-3px;flex-shrink:0;" aria-hidden="true"><path d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z"/></svg></div>
        <h1 class="text-4xl font-bold mb-4">Access Denied</h1>
        <p class="text-gray-400 mb-4">Your account is not authorized.</p>
        <p class="text-gray-500 text-sm mb-8" id="deniedEmail"></p>
        <button id="btnSignOutDenied" class="btn btn-secondary w-full">Sign Out</button>
      </div>
    </div>

    <!-- Alert Banner (fixed top) -->
    <div id="alertBanner" class="alert-banner hidden">
      <span id="alertBannerText"></span>
      <button class="alert-banner-close" onclick="Hub.ui.hideBanner()" title="Dismiss">&times;</button>
    </div>

    <!-- Alert Popup Modal -->
    <div id="alertPopup" class="modal-overlay hidden">
      <div class="card max-w-2xl w-full text-center">
        <div class="mb-4" style="color:#ef4444"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round" class="hh-icon" style="width:64px;height:64px;vertical-align:-3px;flex-shrink:0;" aria-hidden="true"><path d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z"/></svg></div>
        <h2 class="text-3xl font-bold mb-4">Weather Alert</h2>
        <p id="alertPopupText" class="text-xl mb-6"></p>
        <button id="btnDismissAlert" class="btn btn-primary px-8 py-3">Acknowledged</button>
      </div>
    </div>

    <!-- ========== DASHBOARD ========== -->
    <div id="dashboardPage" class="page">
      <div class="max-w-7xl mx-auto p-4 md:p-6">
        <!-- Header -->
        <header class="mb-8 flex flex-col sm:flex-row sm:items-start sm:justify-between gap-4">
          <div>
            <h1 class="text-4xl md:text-5xl font-bold" id="homeHubTitle" style="display:flex;align-items:center;gap:.5rem;"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round" style="width:40px;height:40px;color:#3b82f6" aria-hidden="true"><path d="M2.25 12l8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25"/></svg>Home Hub</h1>
            <p class="text-gray-400 mt-2 text-base" id="dashboardDate"></p>
            <p class="text-blue-400 text-base mt-1" id="dashboardGreeting"></p>
          </div>
          <div class="flex flex-wrap gap-2">
            <button onclick="Hub.router.go('standby')" class="btn btn-secondary text-sm py-2 px-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round" class="hh-icon" style="width:18px;height:18px;vertical-align:-3px;flex-shrink:0;" aria-hidden="true"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg> Standby</button>
            <button onclick="Hub.router.go('status')" class="btn btn-secondary text-sm py-2 px-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round" class="hh-icon" style="width:18px;height:18px;vertical-align:-3px;flex-shrink:0;" aria-hidden="true"><path d="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 013 19.875v-6.75zM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V8.625zM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V4.125z"/></svg> Status</button>
            <button onclick="Hub.router.go('settings')" class="btn btn-secondary text-sm py-2 px-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round" class="hh-icon" style="width:18px;height:18px;vertical-align:-3px;flex-shrink:0;" aria-hidden="true"><path d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.324.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 011.37.49l1.296 2.247a1.125 1.125 0 01-.26 1.431l-1.003.827c-.293.24-.438.613-.431.992a6.759 6.759 0 010 .255c-.007.378.138.75.43.99l1.005.828c.424.35.534.954.26 1.43l-1.298 2.247a1.125 1.125 0 01-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 01-.22.128c-.331.183-.581.495-.644.869l-.213 1.28c-.09.543-.56.941-1.11.941h-2.594c-.55 0-1.02-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 01-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 01-1.369-.49l-1.297-2.247a1.125 1.125 0 01.26-1.431l1.004-.827c.292-.24.437-.613.43-.992a6.932 6.932 0 010-.255c.007-.378-.138-.75-.43-.99l-1.004-.828a1.125 1.125 0 01-.26-1.43l1.297-2.247a1.125 1.125 0 011.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.087.22-.128.332-.183.582-.495.644-.869l.214-1.281z M15 12a3 3 0 11-6 0 3 3 0 016 0z"/></svg> Settings</button>
            <button onclick="Hub.router.go('music')" class="btn btn-secondary text-sm py-2 px-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round" class="hh-icon" style="width:18px;height:18px;vertical-align:-3px;flex-shrink:0;" aria-hidden="true"><path d="M9 9l10.5-3m0 6.553v3.75a2.25 2.25 0 01-1.632 2.163l-1.32.377a1.803 1.803 0 11-.99-3.467l2.31-.66a2.25 2.25 0 001.632-2.163zm0 0V2.25L9 5.25v10.303m0 0v3.75a2.25 2.25 0 01-1.632 2.163l-1.32.377a1.803 1.803 0 01-.99-3.467l2.31-.66A2.25 2.25 0 009 15.553z"/></svg> Music</button>
            <button onclick="Hub.router.go('radio')" class="btn btn-secondary text-sm py-2 px-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round" class="hh-icon" style="width:18px;height:18px;vertical-align:-3px;flex-shrink:0;" aria-hidden="true"><path d="M3.75 3.75v4.5m0-4.5h4.5m-4.5 0L9 9M3.75 20.25v-4.5m0 4.5h4.5m-4.5 0L9 15M20.25 3.75h-4.5m4.5 0v4.5m0-4.5L15 9m5.25 11.25h-4.5m4.5 0v-4.5m0 4.5L15 15"/></svg> Radio</button>
            <button id="btnSignOut" class="btn btn-secondary text-sm py-2 px-4">Sign Out</button>
          </div>
        </header>

        <!-- Main Grid - 2 Column Layout -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          
          <!-- Left Column -->
          <div class="space-y-6">
            
            <!-- Calendar Widget -->
            <div class="card">
              <div id="calendarWidget">
                <p class="text-gray-400 text-sm">Loading calendar...</p>
              </div>
            </div>

            <!-- Weather Card -->
            <div class="card">
              <div class="flex items-center justify-between mb-4">
                <h2 class="text-xl font-bold"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round" class="hh-icon" style="width:20px;height:20px;vertical-align:-3px;flex-shrink:0;" aria-hidden="true"><path d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z"/></svg> Weather</h2>
                <button onclick="Hub.router.go('weather')" class="text-blue-400 hover:text-blue-300 text-sm">
                  Full Forecast ‚Üí
                </button>
              </div>
              <div id="dashboardWeather">
                <p class="text-gray-400 text-sm">Loading weather‚Ä¶</p>
              </div>
            </div>

          </div>
          
          <!-- Right Column -->
          <div class="space-y-6">
            
            <!-- Dog Treat Status Widget -->
            <div class="card">
              <div class="flex items-center justify-between mb-4">
                <h3 class="font-bold text-xl"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round" class="hh-icon" style="width:20px;height:20px;vertical-align:-3px;flex-shrink:0;" aria-hidden="true"><path d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12z"/></svg> Barker</h3>
                <button onclick="Hub.treats.showQuickAdd()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm rounded-lg font-semibold transition-colors">
                  + Treat
                </button>
              </div>
              <div id="dogStatusWidget">
                <p class="text-gray-400 text-sm">Loading...</p>
              </div>
            </div>

            <!-- Chores Preview -->
            <div class="card">
              <div class="flex items-center justify-between mb-4">
                <h2 class="text-xl font-bold">Today's Chores</h2>
                <button onclick="Hub.router.go('chores')" class="text-blue-400 hover:text-blue-300 text-sm">
                  View All ‚Üí
                </button>
              </div>
              <div id="dashboardChores" class="space-y-2">
                <p class="text-gray-400 text-sm">Loading chores...</p>
              </div>
            </div>

            <!-- Now Playing Widget -->
            <div class="card">
              <h2 class="text-xl font-bold mb-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round" class="hh-icon" style="width:20px;height:20px;vertical-align:-3px;flex-shrink:0;" aria-hidden="true"><path d="M9 9l10.5-3m0 6.553v3.75a2.25 2.25 0 01-1.632 2.163l-1.32.377a1.803 1.803 0 11-.99-3.467l2.31-.66a2.25 2.25 0 001.632-2.163zm0 0V2.25L9 5.25v10.303m0 0v3.75a2.25 2.25 0 01-1.632 2.163l-1.32.377a1.803 1.803 0 01-.99-3.467l2.31-.66A2.25 2.25 0 009 15.553z"/></svg> Now Playing</h2>
              <div id="nowPlayingWidget"></div>
            </div>

          </div>

          <!-- Photos Widget - Full Width -->
          <div class="card lg:col-span-2">
            <div class="flex items-center justify-between mb-4">
              <h3 class="font-bold text-xl"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round" class="hh-icon" style="width:20px;height:20px;vertical-align:-3px;flex-shrink:0;" aria-hidden="true"><path d="M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5zm10.5-11.25h.008v.008h-.008V8.25zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z"/></svg> Family Photos</h3>
            </div>
            <div id="immichDashboardWidget" class="min-h-[200px]">
              <p class="text-gray-400 text-sm text-center py-8">Loading photos...</p>
            </div>
          </div>

        </div>
      </div>
    </div>

    <!-- ========== STANDBY ========== -->
    <div id="standbyPage" class="page min-h-screen bg-black text-white relative overflow-hidden cursor-pointer">
      <!-- Full screen photo background - rotating -->
      <div id="standbyPhotoBackground" class="absolute inset-0 transition-opacity duration-1000">
        <img id="standbyCurrentPhoto" class="w-full h-full object-cover" alt="" />
      </div>
      
      <!-- Dark overlay for readability -->
      <div class="absolute inset-0 bg-gradient-to-t from-black via-transparent to-black/20"></div>
      
      <!-- Content overlay - responsive -->
      <div class="relative z-10 min-h-screen p-4 sm:p-6 md:p-8 flex flex-col justify-end" id="standbyContent">
        
        <!-- Time and Date - Bottom Left Corner -->
        <div class="mb-4">
          <!-- Clock -->
          <div id="standbyClock" class="text-5xl sm:text-6xl md:text-7xl font-bold tracking-tight mb-1"></div>
          <!-- Date -->
          <div id="standbyDate" class="text-base sm:text-lg md:text-xl text-gray-300 font-light"></div>
        </div>

        <!-- Info Cards - compact and responsive -->
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4 max-w-6xl w-full mb-4">
          
          <!-- Calendar Events - compact -->
          <div class="bg-black/70 backdrop-blur-md rounded-xl p-3 sm:p-4 border border-white/10">
            <h3 class="text-sm font-semibold mb-2 text-blue-400"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round" class="hh-icon" style="width:16px;height:16px;vertical-align:-3px;flex-shrink:0;" aria-hidden="true"><path d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5A2.25 2.25 0 0121 11.25v7.5"/></svg> Upcoming Events</h3>
            <div id="standbyCalendar" class="space-y-2 text-xs sm:text-sm max-h-32 overflow-hidden">
              <p class="text-gray-400">Loading...</p>
            </div>
          </div>

          <!-- Due Chores - compact -->
          <div class="bg-black/70 backdrop-blur-md rounded-xl p-3 sm:p-4 border border-white/10">
            <h3 class="text-sm font-semibold mb-2 text-green-400"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round" class="hh-icon" style="width:16px;height:16px;vertical-align:-3px;flex-shrink:0;" aria-hidden="true"><path d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg> Chores Due</h3>
            <div id="standbyChores" class="space-y-2 text-xs sm:text-sm max-h-32 overflow-hidden">
              <p class="text-gray-400">Loading...</p>
            </div>
          </div>

          <!-- Weather - compact -->
          <div class="bg-black/70 backdrop-blur-md rounded-xl p-3 sm:p-4 border border-white/10 sm:col-span-2 lg:col-span-1">
            <h3 class="text-sm font-semibold mb-2 text-yellow-400"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round" class="hh-icon" style="width:16px;height:16px;vertical-align:-3px;flex-shrink:0;" aria-hidden="true"><path d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z"/></svg> Weather</h3>
            <div id="standbyWeather" class="text-xs sm:text-sm">
              <p class="text-gray-400">Loading...</p>
            </div>
          </div>

          <!-- Now Playing - compact -->
          <div class="bg-black/70 backdrop-blur-md rounded-xl p-3 sm:p-4 border border-white/10">
            <h3 class="text-sm font-semibold mb-2 text-purple-400"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round" class="hh-icon" style="width:20px;height:20px;vertical-align:-3px;flex-shrink:0;" aria-hidden="true"><path d="M9 9l10.5-3m0 6.553v3.75a2.25 2.25 0 01-1.632 2.163l-1.32.377a1.803 1.803 0 11-.99-3.467l2.31-.66a2.25 2.25 0 001.632-2.163zm0 0V2.25L9 5.25v10.303m0 0v3.75a2.25 2.25 0 01-1.632 2.163l-1.32.377a1.803 1.803 0 01-.99-3.467l2.31-.66A2.25 2.25 0 009 15.553z"/></svg> Now Playing</h3>
            <div id="standbyNowPlaying" class="text-xs sm:text-sm">
              <p class="text-gray-400">Nothing playing</p>
            </div>
          </div>
          
        </div>

        <!-- Tap to wake hint - always at very bottom -->
        <div class="text-center mt-4 sm:mt-6">
          <p class="text-gray-500 text-xs">Tap anywhere to wake</p>
        </div>

      </div>
    </div>

    <!-- ========== WEATHER ========== -->
    <div id="weatherPage" class="page">
      <div class="max-w-7xl mx-auto p-4 md:p-6">
        <header class="flex items-center justify-between mb-6">
          <h1 class="text-3xl font-bold"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round" class="hh-icon" style="width:24px;height:24px;vertical-align:-3px;flex-shrink:0;" aria-hidden="true"><path d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z"/></svg> Weather Center</h1>
          <button onclick="Hub.router.go('dashboard')" class="btn btn-secondary">‚Üê Back</button>
        </header>
        <div id="weatherContent"><p class="text-gray-400">Loading detailed weather‚Ä¶</p></div>
        <div class="card mt-6">
          <h2 class="text-xl font-bold mb-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round" class="hh-icon" style="width:22px;height:22px;vertical-align:-4px;flex-shrink:0;" aria-hidden="true"><path d="M3.75 3.75v4.5m0-4.5h4.5m-4.5 0L9 9M3.75 20.25v-4.5m0 4.5h4.5m-4.5 0L9 15M20.25 3.75h-4.5m4.5 0v4.5m0-4.5L15 9m5.25 11.25h-4.5m4.5 0v-4.5m0 4.5L15 15"/></svg> Rain Radar</h2>
          <div id="rainRadar" class="bg-gray-800 rounded-lg p-4 text-center">
            <p class="text-gray-400 text-sm">Loading radar‚Ä¶</p>
          </div>
        </div>
      </div>
    </div>

    <!-- ========== CHORES ========== -->
    <div id="choresPage" class="page">
      <div class="max-w-7xl mx-auto p-4 md:p-6">
        <header class="flex items-center justify-between mb-6">
          <h1 class="text-3xl font-bold"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round" class="hh-icon" style="width:24px;height:24px;vertical-align:-3px;flex-shrink:0;" aria-hidden="true"><path d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg> Chores</h1>
          <div class="flex gap-3">
            <button id="btnAddChore" class="btn btn-primary">+ Add Chore</button>
            <button onclick="Hub.router.go('dashboard')" class="btn btn-secondary">‚Üê Back</button>
          </div>
        </header>
        <div id="choresList"></div>
      </div>
    </div>

    <!-- ========== TREATS ========== -->
    <div id="treatsPage" class="page">
      <div class="max-w-7xl mx-auto p-4 md:p-6">
        <header class="flex items-center justify-between mb-6">
          <h1 class="text-3xl font-bold"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round" class="hh-icon" style="width:24px;height:24px;vertical-align:-3px;flex-shrink:0;" aria-hidden="true"><path d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12z"/></svg> Dog Treats</h1>
          <button onclick="Hub.router.go('dashboard')" class="btn btn-secondary">‚Üê Back</button>
        </header>
        <div id="dogSelector" class="mb-6"></div>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <div class="card md:col-span-2">
            <h2 class="text-2xl font-bold mb-4" id="selectedDogName">Select a dog</h2>
            <div id="calorieProgress" class="mb-6"></div>
            <div id="todayTreats"></div>
            <div id="weekHistory" class="mt-6"></div>
          </div>
          <div class="card">
            <button id="btnAddTreat" class="btn btn-primary w-full mb-4">+ Log Treat</button>
            <button id="btnAddDog" class="btn btn-secondary w-full">+ Add Dog</button>
          </div>
        </div>
      </div>
    </div>

    <!-- ========== STATUS ========== -->
    <div id="statusPage" class="page">
      <div class="max-w-4xl mx-auto p-4 md:p-6">
        <header class="flex items-center justify-between mb-6">
          <h1 class="text-3xl font-bold"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round" class="hh-icon" style="width:24px;height:24px;vertical-align:-3px;flex-shrink:0;" aria-hidden="true"><path d="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 013 19.875v-6.75zM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V8.625zM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V4.125z"/></svg> System Status</h1>
          <div class="flex gap-3">
            <button id="btnRefreshStatus" class="btn btn-primary">Refresh</button>
            <button onclick="Hub.router.go('dashboard')" class="btn btn-secondary">‚Üê Back</button>
          </div>
        </header>
        <div id="statusContent"><p class="text-gray-400">Checking services‚Ä¶</p></div>
      </div>
    </div>

    <!-- ========== SETTINGS ========== -->
<!-- ========== CONTROL / ADMIN PANEL ========== -->
<!-- Add this BEFORE the settingsPage section in your index.html -->

    <div id="controlPage" class="page">
      <div class="max-w-4xl mx-auto p-4 md:p-6">
        <header class="flex items-center justify-between mb-6">
          <h1 class="text-3xl font-bold"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round" class="hh-icon" style="width:24px;height:24px;vertical-align:-3px;flex-shrink:0;" aria-hidden="true"><path d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09z M18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456z"/></svg> Site Control Center</h1>
          <button onclick="Hub.router.go('dashboard')" class="btn btn-secondary">‚Üê Back</button>
        </header>

        <div id="controlAdminGate" class="card mb-6 hidden">
          <h2 class="text-xl font-bold mb-2"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round" class="hh-icon" style="width:20px;height:20px;vertical-align:-3px;flex-shrink:0;" aria-hidden="true"><path d="M16.5 10.5V6.75a4.5 4.5 0 10-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 002.25-2.25v-6.75a2.25 2.25 0 00-2.25-2.25H6.75a2.25 2.25 0 00-2.25 2.25v6.75a2.25 2.25 0 002.25 2.25z"/></svg> Admin only</h2>
          <p class="text-gray-400 text-sm">This page is restricted to household admins.</p>
        </div>

        <div id="controlContent" class="space-y-6">
          <!-- Admin controls will be added here by control.js -->
          
          <!-- Original Site Control Features -->
          <div class="card">
            <div class="flex items-center justify-between gap-4 mb-4">
              <h2 class="text-xl font-bold">Remote Banner & Maintenance</h2>
              <span class="text-xs text-gray-500">Controls a different site via Supabase</span>
            </div>

            <div class="space-y-4">
              <div>
                <label class="block text-sm font-medium mb-2">Site Name (key)</label>
                <input id="controlSiteName" type="text" class="input" placeholder="main" value="main">
                <p class="text-xs text-gray-500 mt-1">Use multiple names if you want multiple controlled sites.</p>
              </div>

              <div>
                <label class="block text-sm font-medium mb-2">Controlled Site Base URL (optional)</label>
                <input id="controlBaseUrl" type="url" class="input" placeholder="https://example.com">
              </div>

              <div class="flex items-center gap-3">
                <input id="controlMaintenance" type="checkbox" class="w-4 h-4">
                <label for="controlMaintenance" class="text-sm font-medium">Maintenance mode</label>
                <span class="text-xs text-gray-500">(your other site can hide features)</span>
              </div>

              <div>
                <label class="block text-sm font-medium mb-2">Banner message</label>
                <input id="controlBannerMessage" type="text" class="input" placeholder="We'll be back soon‚Ä¶">
              </div>

              <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-medium mb-2">Banner severity</label>
                  <select id="controlBannerSeverity" class="input">
                    <option value="info">Info</option>
                    <option value="warning">Warning</option>
                    <option value="critical">Critical</option>
                  </select>
                </div>
                <div class="flex items-center gap-3 mt-7 sm:mt-0 sm:items-end">
                  <input id="controlPublicRead" type="checkbox" class="w-4 h-4">
                  <label for="controlPublicRead" class="text-sm font-medium">Public read</label>
                </div>
              </div>

              <div>
                <label class="block text-sm font-medium mb-2">Disabled paths (one per line)</label>
                <textarea id="controlDisabledPaths" class="input" rows="5" placeholder="/games\n/admin\n/some-page"></textarea>
                <p class="text-xs text-gray-500 mt-1">Your other site can block or hide these pages/links.</p>
              </div>

              <div class="flex flex-wrap gap-3">
                <button id="btnControlLoad" class="btn btn-secondary">Reload</button>
                <button id="btnControlSave" class="btn btn-primary"> Save</button>
              </div>
              <p id="controlStatus" class="text-xs text-gray-500"></p>
            </div>
          </div>

          <div class="card">
            <div class="flex items-center justify-between mb-3">
              <h2 class="text-xl font-bold">JSON Preview</h2>
              <button id="btnControlCopyJson" class="btn btn-secondary text-sm">Copy</button>
            </div>
            <pre id="controlJsonPreview" class="bg-gray-900 rounded-lg p-4 text-xs overflow-auto max-h-64">Loading‚Ä¶</pre>
          </div>

          <div class="card">
            <h2 class="text-xl font-bold mb-3">Integration Snippet (paste into your other site)</h2>
            <pre id="controlSnippet" class="bg-gray-900 rounded-lg p-4 text-xs overflow-auto">Loading‚Ä¶</pre>
            <p class="text-xs text-gray-500 mt-2">If this page says the table is missing, run the new SQL migration in this repo.</p>
          </div>
        </div>
      </div>
    </div>

    <div id="settingsPage" class="page">
      <div class="max-w-4xl mx-auto p-4 md:p-6">
        <header class="flex items-center justify-between mb-6">
          <h1 class="text-3xl font-bold"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round" class="hh-icon" style="width:18px;height:18px;vertical-align:-3px;flex-shrink:0;" aria-hidden="true"><path d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.324.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 011.37.49l1.296 2.247a1.125 1.125 0 01-.26 1.431l-1.003.827c-.293.24-.438.613-.431.992a6.759 6.759 0 010 .255c-.007.378.138.75.43.99l1.005.828c.424.35.534.954.26 1.43l-1.298 2.247a1.125 1.125 0 01-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 01-.22.128c-.331.183-.581.495-.644.869l-.213 1.28c-.09.543-.56.941-1.11.941h-2.594c-.55 0-1.02-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 01-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 01-1.369-.49l-1.297-2.247a1.125 1.125 0 01.26-1.431l1.004-.827c.292-.24.437-.613.43-.992a6.932 6.932 0 010-.255c.007-.378-.138-.75-.43-.99l-1.004-.828a1.125 1.125 0 01-.26-1.43l1.297-2.247a1.125 1.125 0 011.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.087.22-.128.332-.183.582-.495.644-.869l.214-1.281z M15 12a3 3 0 11-6 0 3 3 0 016 0z"/></svg> Settings</h1>
          <button onclick="Hub.router.go('dashboard')" class="btn btn-secondary">‚Üê Back</button>
        </header>
        <div class="space-y-6">
          <!-- Location -->
          <div class="card">
            <h2 class="text-xl font-bold mb-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round" class="hh-icon" style="width:20px;height:20px;vertical-align:-3px;flex-shrink:0;" aria-hidden="true"><path d="M15 10.5a3 3 0 11-6 0 3 3 0 016 0z M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1115 0z"/></svg> Location</h2>
            <div class="space-y-4">
              <div><label class="block text-sm font-medium mb-2">Location Name</label><input id="settingLocationName" type="text" class="input" placeholder="Home"></div>
              <div class="grid grid-cols-2 gap-4">
                <div><label class="block text-sm font-medium mb-2">Latitude</label><input id="settingLat" type="number" step="0.000001" class="input"></div>
                <div><label class="block text-sm font-medium mb-2">Longitude</label><input id="settingLon" type="number" step="0.000001" class="input"></div>
              </div>
              <button id="btnUseLocation" class="btn btn-secondary text-sm"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round" class="hh-icon" style="width:16px;height:16px;vertical-align:-3px;flex-shrink:0;" aria-hidden="true"><path d="M15 10.5a3 3 0 11-6 0 3 3 0 016 0z M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1115 0z"/></svg> Use Current Location</button>
            </div>
          </div>
          <!-- Immich -->
          <div class="card">
            <h2 class="text-xl font-bold mb-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round" class="hh-icon" style="width:20px;height:20px;vertical-align:-3px;flex-shrink:0;" aria-hidden="true"><path d="M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5zm10.5-11.25h.008v.008h-.008V8.25zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z"/></svg> Immich Photos</h2>
            <div class="space-y-4">
              <div><label class="block text-sm font-medium mb-2">Immich Base URL</label><input id="settingImmichUrl" type="url" class="input" placeholder="http://192.168.1.100:2283"></div>
              <div><label class="block text-sm font-medium mb-2">API Key / Shared Token</label><input id="settingImmichKey" type="password" class="input" placeholder="Your Immich API key or shared link key"></div>
              <div><label class="block text-sm font-medium mb-2">Album ID</label><input id="settingImmichAlbum" type="text" class="input" placeholder="Shared album ID"></div>
            </div>
          </div>
          <!-- Standby -->
          <div class="card">
            <h2 class="text-xl font-bold mb-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round" class="hh-icon" style="width:20px;height:20px;vertical-align:-3px;flex-shrink:0;" aria-hidden="true"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg> Standby Mode</h2>
            <div class="space-y-4">
              <div><label class="block text-sm font-medium mb-2">Auto-enter after (minutes)</label><input id="settingIdleTimeout" type="number" class="input" value="10" min="1" max="60"></div>
              <div class="grid grid-cols-2 gap-4">
                <div><label class="block text-sm font-medium mb-2">Quiet Hours Start</label><input id="settingQuietStart" type="time" class="input" value="22:00"></div>
                <div><label class="block text-sm font-medium mb-2">Quiet Hours End</label><input id="settingQuietEnd" type="time" class="input" value="07:00"></div>
              </div>
            </div>
          </div>
          <!-- Calendar Selection -->
          <div class="card">
            <h2 class="text-xl font-bold mb-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round" class="hh-icon" style="width:20px;height:20px;vertical-align:-3px;flex-shrink:0;" aria-hidden="true"><path d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5A2.25 2.25 0 0121 11.25v7.5"/></svg> Calendar Selection</h2>
            <div id="calendarSelectionContainer">
              <p class="text-gray-400 text-sm mb-3">Choose which Google Calendars to display on your dashboard</p>
              <button id="btnLoadCalendars" class="btn btn-secondary text-sm mb-3">Load My Calendars</button>
              <div id="calendarCheckboxes" class="space-y-2"></div>
            </div>
          </div>
          
          <!-- Changelog -->
          <div class="card">
            <h2 class="text-xl font-bold mb-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round" class="hh-icon" style="width:20px;height:20px;vertical-align:-3px;flex-shrink:0;" aria-hidden="true"><path d="M11.25 11.25l.041-.02a.75.75 0 011.063.852l-.708 2.836a.75.75 0 001.063.853l.041-.021M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9-3.75h.008v.008H12V8.25z"/></svg> What's New</h2>
            <div class="space-y-3 text-sm">
              <div class="border-l-4 border-blue-500 pl-4 py-2">
                <p class="font-semibold text-blue-400">v2.0.0 - February 9, 2026</p>
                <ul class="list-disc pl-5 mt-2 space-y-1 text-gray-400">
                  <li>‚ú® Multi-calendar selection - choose which calendars to display</li>
                  <li>üìÖ Automatic Google Calendar permission requests</li>
                  <li>üë§ Personalization - greetings and chore attribution</li>
                  <li>üå§Ô∏è Redesigned weather center with animated radar</li>
                  <li>üé® Color-coded calendar indicators</li>
                  <li>üíæ Settings now persist forever</li>
                </ul>
              </div>
              <div class="border-l-4 border-gray-500 pl-4 py-2">
                <p class="font-semibold text-gray-300">v1.5.0 - February 8, 2026</p>
                <ul class="list-disc pl-5 mt-2 space-y-1 text-gray-400">
                  <li>Fixed navigation tabs</li>
                  <li>Added standby mode improvements</li>
                  <li>Google Calendar integration</li>
                </ul>
              </div>
              <div class="border-l-4 border-gray-500 pl-4 py-2">
                <p class="font-semibold text-gray-300">v1.0.0 - January 2026</p>
                <ul class="list-disc pl-5 mt-2 space-y-1 text-gray-400">
                  <li>Initial release</li>
                  <li>Chores tracking</li>
                  <li>Dog treat tracker</li>
                  <li>Weather integration</li>
                </ul>
              </div>
            </div>
          </div>

          <!-- Legal & Privacy -->
          <div class="card bg-gray-800">
            <h2 class="text-xl font-bold mb-4"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round" class="hh-icon" style="width:20px;height:20px;vertical-align:-3px;flex-shrink:0;" aria-hidden="true"><path d="M12 7.5h1.5m-1.5 3h1.5m-7.5 3h7.5m-7.5 3h7.5m3-9h3.375c.621 0 1.125.504 1.125 1.125V18a2.25 2.25 0 01-2.25 2.25M16.5 7.5V18a2.25 2.25 0 002.25 2.25M16.5 7.5V4.875c0-.621-.504-1.125-1.125-1.125H4.125C3.504 3.75 3 4.254 3 4.875V18a2.25 2.25 0 002.25 2.25h13.5M6 7.5h3v3H6v-3z"/></svg> Legal & Privacy</h2>
            <div class="space-y-3 text-sm">
              <p class="text-gray-400">Your settings and data are stored securely and persist indefinitely while your account is active.</p>
              <div class="flex flex-wrap gap-4">
                <a href="/privacy.html" target="_blank" class="text-blue-400 hover:text-blue-300 underline">
                  üìú Privacy Policy
                </a>
                <a href="/tos.html" target="_blank" class="text-blue-400 hover:text-blue-300 underline">
                  üìã Terms of Service
                </a>
                <a href="https://myaccount.google.com/permissions" target="_blank" class="text-blue-400 hover:text-blue-300 underline">
                  üîê Manage Google Permissions
                </a>
              </div>
              <p class="text-xs text-gray-500 mt-3">
                Home Hub uses Google Calendar API. By using calendar features, you agree to our Terms of Service and Privacy Policy, 
                and acknowledge our compliance with <a href="https://developers.google.com/terms/api-services-user-data-policy" target="_blank" class="text-blue-400 hover:text-blue-300 underline">Google API Services User Data Policy</a>.
              </p>
            </div>
          </div>

          <button id="btnSaveSettings" class="btn btn-primary w-full py-3"> Save All Settings</button>
          <p class="text-center text-sm text-gray-500 mt-2">Settings are automatically saved to your account and persist forever</p>
        </div>
      </div>
    </div>
  </div>

  <!-- ========== MODALS ========== -->
  <div id="addDogModal" class="modal-overlay hidden">
    <div class="card max-w-lg w-full">
      <h2 class="text-2xl font-bold mb-4">Add Dog</h2>
      <div class="space-y-4">
        <input id="dogName" type="text" placeholder="Name" class="input">
        <input id="dogCalories" type="number" placeholder="Daily calorie limit" class="input" value="1000">
        <div class="flex gap-3">
          <button id="btnSaveDog" class="btn btn-primary flex-1">Add Dog</button>
          <button onclick="Hub.ui.closeModal('addDogModal')" class="btn btn-secondary">Cancel</button>
        </div>
      </div>
    </div>
  </div>

  <div id="addTreatModal" class="modal-overlay hidden">
    <div class="card max-w-lg w-full">
      <h2 class="text-2xl font-bold mb-4">Log Treat</h2>
      <div class="space-y-4">
        <input id="treatName" type="text" placeholder="Treat name" class="input">
        <input id="treatCalories" type="number" placeholder="Calories" class="input">
        <div class="flex gap-3">
          <button id="btnSaveTreat" class="btn btn-primary flex-1">Log Treat</button>
          <button onclick="Hub.ui.closeModal('addTreatModal')" class="btn btn-secondary">Cancel</button>
        </div>
      </div>
    </div>
  </div>

  <div id="addChoreModal" class="modal-overlay hidden">
    <div class="card max-w-lg w-full">
      <h2 class="text-2xl font-bold mb-4">Add Chore</h2>
      <div class="space-y-4">
        <input id="choreTitle" type="text" placeholder="Title" class="input">
        <textarea id="choreDescription" placeholder="Description (optional)" class="input" rows="3"></textarea>
        <select id="choreCategory" class="input">
          <option value="Daily">Daily</option>
          <option value="Monday (Living Room)">Monday (Living Room)</option>
          <option value="Tuesday (Bathrooms)">Tuesday (Bathrooms)</option>
          <option value="Wednesday (Entryway)">Wednesday (Entryway)</option>
          <option value="Thursday (Kitchen)">Thursday (Kitchen)</option>
          <option value="Friday (Bedrooms)">Friday (Bedrooms)</option>
          <option value="Saturday (Miscellaneous)">Saturday (Miscellaneous)</option>
          <option value="Sunday (Grocery/Family)">Sunday (Grocery/Family)</option>
        </select>
        <select id="chorePriority" class="input">
          <option value="low">Low Priority</option>
          <option value="medium" selected>Medium Priority</option>
          <option value="high">High Priority</option>
        </select>
        <div class="flex gap-3">
          <button id="btnSaveChore" class="btn btn-primary flex-1">Create Chore</button>
          <button onclick="Hub.ui.closeModal('addChoreModal')" class="btn btn-secondary">Cancel</button>
        </div>
      </div>
    </div>
  </div>


    <!-- ========== MUSIC PAGE ========== -->
    <div id="musicPage" class="page">
      <div class="max-w-4xl mx-auto p-4 md:p-6">
        <button onclick="Hub.router.go('dashboard')" class="btn btn-secondary mb-4">‚Üê Back to Dashboard</button>
        <h1 class="text-3xl md:text-4xl font-bold mb-6"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round" class="hh-icon" style="width:18px;height:18px;vertical-align:-3px;flex-shrink:0;" aria-hidden="true"><path d="M9 9l10.5-3m0 6.553v3.75a2.25 2.25 0 01-1.632 2.163l-1.32.377a1.803 1.803 0 11-.99-3.467l2.31-.66a2.25 2.25 0 001.632-2.163zm0 0V2.25L9 5.25v10.303m0 0v3.75a2.25 2.25 0 01-1.632 2.163l-1.32.377a1.803 1.803 0 01-.99-3.467l2.31-.66A2.25 2.25 0 009 15.553z"/></svg> Music</h1>
        <div id="musicPlayerContainer"></div>
        <div id="bluetoothHelp" class="mt-6"></div>
      </div>
    </div>

    <!-- ========== RADIO PAGE ========== -->
    <div id="radioPage" class="page">
      <div class="max-w-4xl mx-auto p-4 md:p-6">
        <button onclick="Hub.router.go('dashboard')" class="btn btn-secondary mb-4">‚Üê Back to Dashboard</button>
        <h1 class="text-3xl md:text-4xl font-bold mb-6"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.75" stroke-linecap="round" stroke-linejoin="round" class="hh-icon" style="width:18px;height:18px;vertical-align:-3px;flex-shrink:0;" aria-hidden="true"><path d="M3.75 3.75v4.5m0-4.5h4.5m-4.5 0L9 9M3.75 20.25v-4.5m0 4.5h4.5m-4.5 0L9 15M20.25 3.75h-4.5m4.5 0v4.5m0-4.5L15 9m5.25 11.25h-4.5m4.5 0v-4.5m0 4.5L15 15"/></svg> Radio</h1>
        <div id="radioStationList"></div>
      </div>
    </div>

  <!-- Scripts (order matters) -->
  <script src="assets/utils.js"></script>
  <script src="assets/supabase.js"></script>
  <script src="assets/router.js"></script>
  <script src="assets/ui.js"></script>
  <script src="assets/weather.js"></script>
  <script src="assets/ai.js"></script>
  <script src="assets/calendar.js"></script>
  <script src="assets/treats.js"></script>
  <script src="assets/chores.js"></script>
  <script src="assets/control.js"></script>
  <script src="assets/standby.js"></script>
  <script src="assets/immich.js"></script>
  <script src="assets/player.js"></script>
  <script src="assets/radio.js"></script>
  <script src="assets/music.js"></script>
  <script src="assets/icons.js"></script>
  <script src="assets/app.js"></script>
</body>
</html>
